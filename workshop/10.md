# Typer

Typer is the FastAPI of command line interfaces. It works in much the same way - you can make a
really nice CLI just by adding decorators to functions.

Let's create a function called `main` that takes a single argument `name`, and prints it:

```python
def main(name: str):
    print(f"Hello {name}")
```

If we save this and run it with `typer`:

```
$ typer main.py run --help
```

Typer turned our simple function into a CLI command.

Let's run it with a single argument:

```
$ typer main.py run Ben
```

It passes our argument into the function.

We haven't even imported Typer - but we will need to for more advanced use.

## Library CLI

There's a skeleton Typer app in the library in `lib/pybrary/cli/__init__.py`. We can run it with:

```
$ pybrary
```

It's configured to run the `--help` command when run with no arguments.

The CLI has two commands defined: a test one and an empty `do_get_book`.

We can run the test one first, and make sure it's running properly. If not, check your `.env` file.

Let's add a command to retrieve a book's info from the CLI.

```python
from ..client import PybraryApiClient

...

api = PybraryApiClient()

...

@app.command("book", help="Get a book")
def do_get_book(book_id: int):
    book = api.get_book(book_id)
    print(book)
```

Maybe we want a formatted string instead:

```python
print(f"{book.title} by {book.author} published in {book.year_published}")
```

The `rich` library makes it easy to output a table:

```python
from rich import print
from rich.table import Table

...

@app.command("book", help="Get a book")
def do_get_book(book_id: int):
    book = api.get_book(book_id)
    table = Table(show_header=True)
    for header in ("Title", "Author", "Year published"):
        table.add_column(header)
    table.add_row(book.title, book.author, str(book.year_published))
    print(table)
```

## Arguments

If we use annotations to define our arguments, we can attach help strings to them:

```python
from typing import Annotated

from typer import Argument

...

def do_get_book(book_id: Annotated[int, Argument(help="The ID of the book to retrieve")]):
```

In some cases we may wish to reuse arguments so we could define them separately, perhaps in another
file within the `cli` submodule:

```python
book_id_arg = Annotated[int, Argument(help="The ID of the book to retrieve")]

...

def do_get_book(book_id: book_id_arg):
```

We can also set a default value, for example if the argument was optional:

```python
bar_arg = Annotated[str | None, Argument(help="The bar of the book")]

def foo(bar: bar_arg = None):
```

## Options

Similarly we can use annotated options:

```python
from typer import Option

...

table_opt = Annotated[bool, Option(help="Show the data in a table format")]
```

## Excercise

- Make table mode optional, and use a simple string as fallback
- Add more commands for your API
- Add more routes to your API and repeat

Refer to the Typer docs for more info: https://typer.tiangolo.com/